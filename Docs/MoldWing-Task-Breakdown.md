# MoldWing 任务拆分（Qt 方案）

> **版本**: 2.3
> **创建日期**: 2025-12-26
> **最后更新**: 2025-12-27
> **拆分层次**: Epic (里程碑) → Story (功能模块) → Task (具体任务)

---

## 当前进度概览

| 里程碑 | 状态 | 进度 |
|-------|------|------|
| M1 基础框架 | ✅ 完成 | 100% |
| M2 框选 | ✅ 完成 | 100% |
| M3 刷选 | ✅ 完成 | 100% |
| M4 套索选择 | ✅ 完成 | 100% |
| M5 连通选择 | ✅ 完成 | 100% |
| M6 纹理渲染+编辑框架 | ⏳ 待开始 | 0% |
| M7 克隆图章 | ⏳ 待开始 | 0% |
| M8 橡皮擦 | ⏳ 待开始 | 0% |
| M9 颜色调整 | ⏳ 待开始 | 0% |
| M10 几何修复 | ⏳ 待开始 | 0% |
| M11 导入导出 | ⏳ 待开始 | 0% |

**状态说明**: ✅ 已完成 | 🔄 进行中 | ⏳ 待开始

---

## 技术栈

| 组件 | 技术 |
|-----|------|
| UI框架 | **Qt 6 Widgets** |
| 渲染引擎 | DiligentEngine |
| 几何处理 | CGAL + Eigen3 |
| 模型加载 | assimp |
| 日志系统 | **spdlog** |

---

## 任务依赖关系图

```
M1 基础框架 ──┬──> M2 框选 ──> M3 刷选 ──> M4 套索 ──> M5 连通
(Qt+Diligent) │
              ├──> M6 纹理渲染+编辑框架 ──┬──> M7 克隆图章
              │                          └──> M8 橡皮擦
              │                               └──> M9 颜色调整
              │
              └──> M10 几何修复 ──> M11 导入导出
```

### 纹理编辑技术方案

**屏幕空间投影编辑**（区别于传统UV展开方案）：
- 用户在3D视图直接操作，编辑模式下锁定视角
- 系统将屏幕坐标映射到纹理坐标
- 实际编辑在纹理空间进行（保持原生分辨率）
- 共享纹理区域自动同步更新
- 多角度编辑：退出→旋转→重新进入

---

## M1: 基础框架（Qt + DiligentEngine） ✅ 100%

### S1.1 项目骨架搭建 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T1.1.1 | 创建 Apps/MoldWing/ 目录结构 | 0.5h | - | ✅ |
| T1.1.2 | 编写 CMakeLists.txt（Qt6 + DiligentEngine） | 1.5h | T1.1.1 | ✅ |
| T1.1.3 | 更新 vcpkg.json 添加依赖 | 0.5h | - | ✅ |
| T1.1.4 | 创建 main.cpp（QApplication 入口） | 0.5h | T1.1.2 | ✅ |
| T1.1.5 | 验证 Qt 窗口显示 | 0.5h | T1.1.4 | ✅ |

### S1.2 Qt + DiligentEngine 集成 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T1.2.1 | 创建 DiligentWidget 类（QWidget子类） | 1h | S1.1 | ✅ |
| T1.2.2 | 获取 Qt 窗口原生句柄 (winId) | 0.5h | T1.2.1 | ✅ |
| T1.2.3 | 初始化 DiligentEngine Device/Context | 2h | T1.2.2 | ✅ |
| T1.2.4 | 创建 SwapChain 绑定到 Qt 窗口 | 1h | T1.2.3 | ✅ |
| T1.2.5 | 实现 paintEvent 触发渲染 | 1h | T1.2.4 | ✅ |
| T1.2.6 | 实现 resizeEvent 处理窗口大小变化 | 0.5h | T1.2.5 | ✅ |
| T1.2.7 | 验证基础渲染（清屏颜色） | 0.5h | T1.2.6 | ✅ |

### S1.3 网格数据结构 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T1.3.1 | 定义 Vertex 结构体（position, normal, texcoord） | 0.5h | S1.1 | ✅ |
| T1.3.2 | 定义 MeshData 结构体（vertices, indices） | 0.5h | T1.3.1 | ✅ |
| T1.3.3 | 定义 TextureData 结构体（使用 QImage） | 0.5h | T1.3.1 | ✅ |
| T1.3.4 | 实现邻接表构建 | 1h | T1.3.2 | ✅ |

### S1.4 模型加载（assimp） ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T1.4.1 | 集成 assimp 库 | 0.5h | S1.1 | ✅ |
| T1.4.2 | 实现 MeshLoader::loadOBJ() | 2h | T1.4.1, S1.3 | ✅ |
| T1.4.3 | 加载纹理（QImage / stb_image） | 1h | T1.4.2 | ⏳ (M6) |
| T1.4.4 | 测试加载示例 OBJ 模型 | 0.5h | T1.4.3 | ✅ |

### S1.5 网格渲染 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T1.5.1 | 创建顶点缓冲和索引缓冲 | 1h | S1.4, S1.2 | ✅ |
| T1.5.2 | 编写顶点着色器（MVP变换） | 1h | T1.5.1 | ✅ |
| T1.5.3 | 编写片段着色器（Blinn-Phong光照） | 1h | T1.5.2 | ✅ |
| T1.5.4 | 创建图形管线 PSO | 1h | T1.5.3 | ✅ |
| T1.5.5 | 实现 MeshRenderer::render() | 1h | T1.5.4 | ✅ |
| T1.5.6 | 添加纹理采样支持 | 1h | T1.5.5 | ⏳ (M6) |

### S1.6 相机系统（增强版） ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T1.6.1 | 实现 OrbitCamera 基础类 | 1h | S1.2 | ✅ |
| T1.6.2 | 重写 mousePressEvent（开始拖拽） | 0.5h | T1.6.1 | ✅ |
| T1.6.3 | 重写 mouseMoveEvent（旋转/平移） | 1h | T1.6.2 | ✅ |
| T1.6.4 | 重写 wheelEvent（缩放） | 0.5h | T1.6.1 | ✅ |
| T1.6.5 | 实现 fitToModel()（自动适配） | 0.5h | T1.6.4 | ✅ |
| T1.6.6 | 创建 CameraSettings 配置结构 | 0.5h | T1.6.1 | ✅ |
| T1.6.7 | 实现平滑插值系统 | 1h | T1.6.6 | ✅ |
| T1.6.8 | 实现惯性系统（鼠标释放后动量） | 1h | T1.6.7 | ✅ |
| T1.6.9 | 实现缩放到光标功能 | 0.5h | T1.6.4 | ✅ |
| T1.6.10 | 添加视图预设（Front/Back/Top/Bottom/Left/Right/Iso） | 1h | T1.6.1 | ✅ |
| T1.6.11 | 实现视图切换动画 | 1h | T1.6.10 | ✅ |
| T1.6.12 | Blender风格鼠标控制（MMB旋转/Shift+MMB平移） | 1h | T1.6.3 | ✅ |
| T1.6.13 | 实现Numpad快捷键（1/3/7/0/5） | 0.5h | T1.6.10 | ✅ |
| T1.6.14 | 实现约束旋转（Ctrl吸附45度） | 0.5h | T1.6.3 | ✅ |
| T1.6.15 | 添加右键上下文菜单 | 0.5h | T1.6.10 | ✅ |
| T1.6.16 | 正交/透视投影切换 | 0.5h | T1.6.1 | ✅ |

### S1.7 撤销/重做系统（QUndoStack） ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T1.7.1 | 创建 QUndoStack | 0.5h | S1.1 | ✅ |
| T1.7.2 | 创建 QUndoView 显示历史 | 0.5h | T1.7.1 | ✅ |
| T1.7.3 | 配置 Ctrl+Z / Ctrl+Y 快捷键 | 0.5h | T1.7.1 | ✅ |

### S1.8 Qt 主窗口布局 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T1.8.1 | 创建 MainWindow 类（QMainWindow） | 1h | S1.2 | ✅ |
| T1.8.2 | 设置 DiligentWidget 为中央窗口 | 0.5h | T1.8.1 | ✅ |
| T1.8.3 | 创建左侧工具 QDockWidget | 1h | T1.8.1 | ✅ |
| T1.8.4 | 创建右侧属性 QDockWidget | 1h | T1.8.1 | ✅ |
| T1.8.5 | 创建历史记录 QDockWidget（tabify） | 0.5h | T1.8.4 | ✅ |
| T1.8.6 | 创建菜单栏（文件/编辑/视图） | 1h | T1.8.1 | ✅ |
| T1.8.7 | 创建工具栏 | 1h | T1.8.1 | ✅ |
| T1.8.8 | 创建状态栏 | 0.5h | T1.8.1 | ✅ |
| T1.8.9 | 实现 saveState/restoreState 布局保存 | 0.5h | T1.8.5 | ✅ |

### S1.9 日志系统（spdlog） ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T1.9.1 | 添加 spdlog 依赖到 vcpkg.json | 0.2h | S1.1 | ✅ |
| T1.9.2 | 创建 Logger 单例类 | 1h | T1.9.1 | ✅ |
| T1.9.3 | 配置日志输出到 exe 同级 logs/ 目录 | 0.5h | T1.9.2 | ✅ |
| T1.9.4 | 实现日志文件命名（日期+进程ID） | 0.5h | T1.9.3 | ✅ |
| T1.9.5 | 实现启动时清理上次日志 | 0.5h | T1.9.4 | ✅ |
| T1.9.6 | 集成 Windows MiniDump 崩溃捕获 | 1.5h | T1.9.2 | ✅ |
| T1.9.7 | 崩溃时自动保存日志和 .dmp 文件 | 1h | T1.9.6 | ✅ |
| T1.9.8 | 定义日志宏（MW_LOG_INFO/WARN/ERROR等） | 0.5h | T1.9.2 | ✅ |
| T1.9.9 | 在 main.cpp 初始化日志系统 | 0.3h | T1.9.8 | ✅ |

**M1 总计: ~44h（已完成）**

> 注意: T1.4.3 和 T1.5.6 (纹理相关) 推迟到 M6 纹理视图里程碑
>
> **2025-12-27 更新**: S1.6 相机系统增强，添加了平滑插值、惯性、视图预设、Blender风格控制等专业功能

---

## M2: 框选 ✅ 100%

### S2.1 GPU 拾取系统 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T2.1.1 | 创建 ID 渲染目标（R32_UINT格式） | 1h | M1 | ✅ |
| T2.1.2 | 编写 ID 渲染着色器 | 1h | T2.1.1 | ✅ |
| T2.1.3 | 实现 renderIDBuffer() | 1h | T2.1.2 | ✅ |
| T2.1.4 | 实现 readFaceID(screenPos) | 1h | T2.1.3 | ✅ |
| T2.1.5 | 实现 readFaceIDsInRect() | 1h | T2.1.4 | ✅ |

### S2.2 选择系统核心 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T2.2.1 | 创建 SelectionSystem 类（QObject） | 0.5h | S2.1 | ✅ |
| T2.2.2 | 实现 selectedFaces 集合管理 | 0.5h | T2.2.1 | ✅ |
| T2.2.3 | 定义 selectionChanged 信号 | 0.2h | T2.2.1 | ✅ |
| T2.2.4 | 实现 invertSelection() | 0.5h | T2.2.2 | ✅ |
| T2.2.5 | 实现 clearSelection() | 0.2h | T2.2.2 | ✅ |
| T2.2.6 | 实现 selectAll() | 0.2h | T2.2.2 | ✅ |
| T2.2.7 | 创建 SelectFacesCommand（QUndoCommand） | 1h | T2.2.2 | ✅ |

### S2.3 框选实现 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T2.3.1 | 处理 mousePressEvent 开始框选 | 0.5h | S2.2 | ✅ |
| T2.3.2 | 处理 mouseMoveEvent 更新框选 | 0.5h | T2.3.1 | ✅ |
| T2.3.3 | 使用 QRubberBand 绘制框选矩形 | 1h | T2.3.2 | ✅ |
| T2.3.4 | 处理 mouseReleaseEvent 完成框选 | 1h | T2.3.3 | ✅ |
| T2.3.5 | 支持 Ctrl 增选 / Shift 减选 | 0.5h | T2.3.4 | ✅ |

### S2.4 选择可视化 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T2.4.1 | 创建选中面高亮着色器 | 1h | S2.3 | ✅ |
| T2.4.2 | 实现 SelectionRenderer 类 | 1h | T2.4.1 | ✅ |
| T2.4.3 | 支持选中面半透明叠加 | 0.5h | T2.4.2 | ✅ |

**M2 总计: ~14h（已完成）**

> **2025-12-27 更新**: M2 框选功能完成
> - FacePicker: GPU 拾取系统，使用 SV_PrimitiveID 渲染面 ID 到离屏缓冲
> - SelectionSystem: 选择管理，支持 Qt 信号和 QUndoCommand
> - SelectionRenderer: 选中面高亮渲染（半透明叠加 + DepthBias 解决 z-fighting）
> - SelectionBoxRenderer: DiligentEngine 渲染框选矩形（替代 Qt 叠加层，解决合成问题）
> - 支持 Ctrl 增选、Shift 减选

---

## M3: 刷选 ✅ 100%

### S3.1 刷选核心 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T3.1.1 | 添加 SelectMode::Brush 模式 | 0.5h | M2 | ✅ |
| T3.1.2 | 实现 brushRadius 属性 | 0.2h | T3.1.1 | ✅ |
| T3.1.3 | 实现 updateBrushSelect() | 1h | T3.1.2 | ✅ |
| T3.1.4 | 使用 BrushCursorRenderer 绘制刷选圆形光标 | 1h | T3.1.3 | ✅ |
| T3.1.5 | 支持 [ ] 快捷键调整笔刷大小 | 0.5h | T3.1.4 | ✅ |

### S3.2 刷选优化 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T3.2.1 | 优化：仅检测笔刷范围内的面 (readFaceIDsInCircle) | 1h | S3.1 | ✅ |
| T3.2.2 | 支持持续拖拽选择 | 0.5h | T3.2.1 | ✅ |
| T3.2.3 | 属性面板：笔刷大小滑块 (QSlider + QSpinBox) | 0.5h | T3.2.2 | ✅ |

**M3 总计: ~5h（已完成）**

> **2025-12-27 更新**: M3 刷选功能完成
> - BrushCursorRenderer: DiligentEngine 渲染圆形笔刷光标（NDC 空间 2D 叠加）
> - FacePicker::readFaceIDsInCircle: 圆形区域内的面 ID 批量读取
> - DiligentWidget: 刷选状态管理、连续拖拽选择、快捷键支持
> - MainWindow: 属性面板笔刷大小滑块（与键盘快捷键双向同步）
> - 使用 PRIMITIVE_TOPOLOGY_TRIANGLE_LIST 绘制圆形（DiligentEngine 不支持 TRIANGLE_FAN）

---

## M4: 套索选择 ✅ 100%

### S4.1 套索核心 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T4.1.1 | 添加 SelectMode::Lasso 模式 | 0.5h | M3 | ✅ |
| T4.1.2 | 使用 QPolygonF 记录鼠标轨迹 | 0.5h | T4.1.1 | ✅ |
| T4.1.3 | 使用 LassoRenderer 绘制套索轨迹 | 1h | T4.1.2 | ✅ |
| T4.1.4 | 实现多边形闭合检测 | 0.5h | T4.1.3 | ✅ |

### S4.2 点在多边形内判断 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T4.2.1 | 使用 QPolygonF::containsPoint() | 0.5h | S4.1 | ✅ |
| T4.2.2 | 实现 endLassoSelect() | 1h | T4.2.1 | ✅ |
| T4.2.3 | 优化：采样点简化 | 0.5h | T4.2.2 | ✅ |

**M4 总计: ~5h（已完成）**

> **2025-12-27 更新**: M4 套索选择功能完成
> - LassoRenderer: DiligentEngine 渲染套索路径（NDC 空间 2D 叠加，仅边框线）
> - QPolygonF: 记录鼠标轨迹，使用 containsPoint() 判断面中心是否在套索内
> - OrbitCamera::worldToScreen: 新增将世界坐标投影到屏幕空间的方法
> - DiligentWidget: 套索状态管理（begin/update/endLassoSelect）
> - 支持 Ctrl 增选、Shift 减选
> - 采样点简化：LassoRenderer::addPoint 中实现最小距离过滤
> - 修复套索显示闪烁问题（移除非凸多边形填充渲染）

---

## M5: 连通选择 ✅ 100%

### S5.1 邻接关系 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T5.1.1 | 构建面-面邻接表 | 1h | M4 | ✅ |
| T5.1.2 | 缓存邻接关系 | 0.5h | T5.1.1 | ✅ |

### S5.2 连通选择 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T5.2.1 | 添加 SelectMode::Link 模式 | 0.5h | S5.1 | ✅ |
| T5.2.2 | 实现 selectLinked() BFS | 1h | T5.2.1 | ✅ |
| T5.2.3 | 实现 selectByAngle() 角度限制 | 1h | T5.2.2 | ✅ |
| T5.2.4 | 属性面板：角度阈值滑块 | 0.5h | T5.2.3 | ✅ |

### S5.3 选择扩展/收缩 ✅
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T5.3.1 | 实现 growSelection() | 0.5h | S5.2 | ✅ |
| T5.3.2 | 实现 shrinkSelection() | 0.5h | T5.3.1 | ✅ |

**M5 总计: ~6h（已完成）**

> **2025-12-27 更新**: M5 连通选择功能完成
> - MeshData::buildAdjacency: 基于共享边构建面-面邻接表
> - MeshData::computeFaceNormals: 计算面法向量用于角度判断
> - SelectionSystem::selectLinked: BFS 算法选择所有连通面
> - SelectionSystem::selectByAngle: 基于法向量夹角限制的连通选择
> - SelectionSystem::growSelection: 扩展选择到相邻面
> - SelectionSystem::shrinkSelection: 移除边界面收缩选择
> - 属性面板角度阈值滑块（0°=共面，180°=全连通）
> - 菜单项：Ctrl++ 扩展选择，Ctrl+- 收缩选择

---

## M6: 纹理渲染 + 编辑模式框架

### S6.1 纹理渲染基础
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T6.1.1 | 创建 Material 数据结构（diffuseTexPath, textureId） | 0.5h | M5 | ⏳ |
| T6.1.2 | 创建 TextureLoader（stb_image 加载 PNG/JPG/TGA） | 1h | T6.1.1 | ⏳ |
| T6.1.3 | MeshData 扩展（materials 列表、Face.materialId） | 0.5h | T6.1.1 | ⏳ |
| T6.1.4 | MeshLoader 扩展（读取 MTL 材质文件、加载纹理） | 2h | T6.1.2, T6.1.3 | ⏳ |
| T6.1.5 | 创建 GPU 纹理（ITexture）和采样器（ISampler） | 1h | T6.1.4 | ⏳ |
| T6.1.6 | 修改 MeshRenderer 着色器支持纹理采样 | 1h | T6.1.5 | ⏳ |
| T6.1.7 | 绑定纹理 SRV 到 PSO | 1h | T6.1.6 | ⏳ |
| T6.1.8 | 验证带纹理模型渲染 | 0.5h | T6.1.7 | ⏳ |

### S6.2 屏幕-纹理映射系统
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T6.2.1 | FacePicker 扩展 pickPoint(x,y) 返回 {faceId, depth} | 1h | S6.1 | ⏳ |
| T6.2.2 | 实现 BarycentricCalculator（屏幕坐标→重心坐标） | 1.5h | T6.2.1 | ⏳ |
| T6.2.3 | 实现 UVInterpolator（重心坐标→精确UV坐标） | 1h | T6.2.2 | ⏳ |
| T6.2.4 | 创建 ScreenToTextureMapper 类 | 0.5h | T6.2.3 | ⏳ |
| T6.2.5 | 实现可见面映射表预计算和缓存 | 1.5h | T6.2.4 | ⏳ |
| T6.2.6 | 单元测试：屏幕坐标→纹理坐标转换 | 1h | T6.2.5 | ⏳ |

### S6.3 编辑模式框架
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T6.3.1 | 创建 TextureEditMode 类（编辑状态管理） | 1h | S6.2 | ⏳ |
| T6.3.2 | 实现 enterEditMode() / exitEditMode() | 0.5h | T6.3.1 | ⏳ |
| T6.3.3 | 实现视角锁定（禁止旋转/平移/缩放） | 0.5h | T6.3.2 | ⏳ |
| T6.3.4 | 状态栏提示 "编辑模式 - 视角已锁定" | 0.3h | T6.3.3 | ⏳ |
| T6.3.5 | 创建 TextureEditBuffer（CPU 纹理副本） | 1h | T6.3.1 | ⏳ |
| T6.3.6 | 实现脏区域跟踪（dirty regions） | 1h | T6.3.5 | ⏳ |
| T6.3.7 | 实现 GPU 纹理同步（脏区域更新） | 1h | T6.3.6 | ⏳ |
| T6.3.8 | 实现 ScreenCapture（工具激活时截取屏幕） | 1h | T6.3.1 | ⏳ |
| T6.3.9 | 创建 TextureEditCommand（QUndoCommand） | 1h | T6.3.5 | ⏳ |
| T6.3.10 | 实现每笔撤销（记录像素变更） | 1h | T6.3.9 | ⏳ |
| T6.3.11 | 实现 saveTexture() 手动保存功能 | 1h | T6.3.5 | ⏳ |
| T6.3.12 | 编辑工具基类 TextureEditTool | 0.5h | T6.3.1 | ⏳ |

**M6 总计: ~22h**

> **方案说明**: M6 重新定义为"纹理渲染 + 编辑模式框架"，采用屏幕空间投影编辑方案，
> 不再是传统的 UV 视图。用户在 3D 视图直接操作，系统将屏幕坐标映射到纹理坐标。

---

## M7: 克隆图章工具

### S7.1 克隆图章核心
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T7.1.1 | 创建 CloneStampTool 类（继承 TextureEditTool） | 0.5h | M6 | ⏳ |
| T7.1.2 | 实现 setCloneSource()（Alt+点击设置源点） | 1h | T7.1.1 | ⏳ |
| T7.1.3 | 屏幕坐标→纹理坐标转换（源点） | 0.5h | T7.1.2 | ⏳ |
| T7.1.4 | 实现克隆绘制（拖拽时复制像素） | 2h | T7.1.3 | ⏳ |
| T7.1.5 | 纹理空间像素采样和写入 | 1h | T7.1.4 | ⏳ |
| T7.1.6 | 显示克隆源点标记（十字标记） | 0.5h | T7.1.2 | ⏳ |

### S7.2 克隆图章优化
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T7.2.1 | 实现笔刷大小调节 | 0.5h | S7.1 | ⏳ |
| T7.2.2 | 实现笔刷硬度（边缘羽化） | 1h | T7.2.1 | ⏳ |
| T7.2.3 | 实现笔画插值（连续绘制） | 1h | T7.2.2 | ⏳ |
| T7.2.4 | 属性面板：笔刷大小/硬度滑块 | 0.5h | T7.2.3 | ⏳ |
| T7.2.5 | 快捷键 S 激活克隆图章 | 0.2h | T7.2.4 | ⏳ |

**M7 总计: ~9h**

---

## M8: 橡皮擦工具

### S8.1 橡皮擦核心
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T8.1.1 | 创建 EraserTool 类（继承 TextureEditTool） | 0.5h | M6 | ⏳ |
| T8.1.2 | 保存原始纹理副本（用于恢复） | 0.5h | T8.1.1 | ⏳ |
| T8.1.3 | 实现橡皮擦绘制（恢复原始纹理） | 1.5h | T8.1.2 | ⏳ |
| T8.1.4 | 屏幕坐标→纹理坐标转换 | 0.5h | T8.1.3 | ⏳ |

### S8.2 橡皮擦优化
| ID | Task | 预计 | 依赖 | 状态 |
|----|------|------|------|------|
| T8.2.1 | 实现笔刷大小调节 | 0.5h | S8.1 | ⏳ |
| T8.2.2 | 实现笔刷硬度（边缘羽化） | 0.5h | T8.2.1 | ⏳ |
| T8.2.3 | 属性面板：笔刷大小滑块 | 0.3h | T8.2.2 | ⏳ |
| T8.2.4 | 快捷键 E 激活橡皮擦 | 0.2h | T8.2.3 | ⏳ |

**M8 总计: ~5h**

---

## M9: 颜色调整

### S9.1 基础调整
| ID | Task | 预计 | 依赖 |
|----|------|------|------|
| T9.1.1 | 实现 adjustBrightness() | 1h | M7 |
| T9.1.2 | 实现 adjustContrast() | 1h | T9.1.1 |
| T9.1.3 | 实现 adjustHueSaturation() | 1.5h | T9.1.2 |
| T9.1.4 | 创建 ColorAdjustCommand | 1h | T9.1.3 |

### S9.2 高级调整
| ID | Task | 预计 | 依赖 |
|----|------|------|------|
| T9.2.1 | 实现 applyLevels() | 1.5h | S9.1 |
| T9.2.2 | 实现 applyCurves() | 2h | T9.2.1 |

### S9.3 调整UI
| ID | Task | 预计 | 依赖 |
|----|------|------|------|
| T9.3.1 | 亮度/对比度滑块 | 0.5h | S9.2 |
| T9.3.2 | 色相/饱和度滑块 | 0.5h | T9.3.1 |
| T9.3.3 | 色阶直方图（QCustomPlot或手绘） | 1h | T9.3.2 |
| T9.3.4 | 曲线编辑器 | 2h | T9.3.3 |

**M9 总计: ~12h**

---

## M10: 几何修复

### S10.1 CGAL 集成
| ID | Task | 预计 | 依赖 |
|----|------|------|------|
| T10.1.1 | 配置 CGAL + Eigen3 | 1h | M5 |
| T10.1.2 | MeshData ↔ CGAL Surface_mesh 转换 | 2h | T10.1.1 |

### S10.2 孔洞检测与填充
| ID | Task | 预计 | 依赖 |
|----|------|------|------|
| T10.2.1 | 实现 detectHoles() | 1h | S10.1 |
| T10.2.2 | 实现孔洞边缘高亮 | 1h | T10.2.1 |
| T10.2.3 | 实现 fillHole() | 2h | T10.2.2 |
| T10.2.4 | 实现 fillAllHoles() | 0.5h | T10.2.3 |
| T10.2.5 | 创建 FillHoleCommand | 1h | T10.2.4 |

### S10.3 网格清理
| ID | Task | 预计 | 依赖 |
|----|------|------|------|
| T10.3.1 | 实现 analyzeMesh() | 1h | S10.1 |
| T10.3.2 | 实现非流形边修复 | 2h | T10.3.1 |
| T10.3.3 | 实现重复顶点合并 | 1h | T10.3.2 |
| T10.3.4 | 实现退化三角形删除 | 1h | T10.3.3 |

### S10.4 删除选中面
| ID | Task | 预计 | 依赖 |
|----|------|------|------|
| T10.4.1 | 实现 deleteSelectedFaces() | 1h | S10.3 |
| T10.4.2 | 创建 DeleteFacesCommand | 1h | T10.4.1 |

**M10 总计: ~16h**

---

## M11: 导入导出

### S11.1 OBJ 导出
| ID | Task | 预计 | 依赖 |
|----|------|------|------|
| T11.1.1 | 实现 saveOBJ() | 2h | M10 |
| T11.1.2 | 导出纹理文件 | 1h | T11.1.1 |
| T11.1.3 | 生成 MTL 材质文件 | 1h | T11.1.2 |

### S11.2 PLY 导出
| ID | Task | 预计 | 依赖 |
|----|------|------|------|
| T11.2.1 | 实现 savePLY() | 1h | S11.1 |

### S11.3 OSGB 支持
| ID | Task | 预计 | 依赖 |
|----|------|------|------|
| T11.3.1 | 研究 OSGB 格式 | 2h | S11.1 |
| T11.3.2 | 集成 osg/osgDB | 4h | T11.3.1 |
| T11.3.3 | 实现 loadOSGB() | 4h | T11.3.2 |
| T11.3.4 | 实现 saveOSGB() | 3h | T11.3.3 |

**M11 总计: ~18h**

---

## 任务统计

| 里程碑 | 预计工时 | 已完成 | 进度 |
|-------|---------|--------|------|
| M1 基础框架 | 44h | 44h | ✅ 100% |
| M2 框选 | 14h | 14h | ✅ 100% |
| M3 刷选 | 5h | 5h | ✅ 100% |
| M4 套索选择 | 5h | 5h | ✅ 100% |
| M5 连通选择 | 6h | 6h | ✅ 100% |
| M6 纹理渲染+编辑框架 | 22h | 0h | ⏳ 0% |
| M7 克隆图章 | 9h | 0h | ⏳ 0% |
| M8 橡皮擦 | 5h | 0h | ⏳ 0% |
| M9 颜色调整 | 12h | 0h | ⏳ 0% |
| M10 几何修复 | 16h | 0h | ⏳ 0% |
| M11 导入导出 | 18h | 0h | ⏳ 0% |
| **总计** | **~156h** | **~74h** | **~47%** |

---

## 下一步工作：M6 纹理渲染 + 编辑模式框架

M5 连通选择功能已完成，下一步开始实现 M6 纹理渲染和编辑模式框架：

### 🔥 优先：纹理渲染基础（S6.1）
| ID | Task | 预计 |
|----|------|------|
| T6.1.1 | 创建 Material 数据结构 | 0.5h |
| T6.1.2 | 创建 TextureLoader（stb_image） | 1h |
| T6.1.3 | MeshData 扩展（材质列表） | 0.5h |
| T6.1.4 | MeshLoader 读取 MTL 材质文件 | 2h |
| T6.1.5 | 创建 GPU 纹理和采样器 | 1h |
| T6.1.6 | 修改着色器支持纹理采样 | 1h |
| T6.1.7 | 绑定纹理 SRV 到 PSO | 1h |
| T6.1.8 | 验证带纹理模型渲染 | 0.5h |

### 屏幕-纹理映射系统（S6.2）
| ID | Task | 预计 |
|----|------|------|
| T6.2.1 | FacePicker 扩展 pickPoint | 1h |
| T6.2.2 | BarycentricCalculator | 1.5h |
| T6.2.3 | UVInterpolator | 1h |
| T6.2.4 | ScreenToTextureMapper 类 | 0.5h |
| T6.2.5 | 可见面映射表缓存 | 1.5h |

### 编辑模式框架（S6.3）
| ID | Task | 预计 |
|----|------|------|
| T6.3.1 | TextureEditMode 类 | 1h |
| T6.3.2-4 | 进入/退出 + 视角锁定 + 状态栏 | 1.3h |
| T6.3.5-7 | TextureEditBuffer + 脏区域 + GPU同步 | 3h |
| T6.3.8 | ScreenCapture | 1h |
| T6.3.9-10 | TextureEditCommand + 每笔撤销 | 2h |
| T6.3.11 | saveTexture 保存功能 | 1h |

---

**文档版本**: 3.0 (Qt 方案 - M6-M8 纹理编辑方案重新定义)
**最后更新**: 2025-12-27
